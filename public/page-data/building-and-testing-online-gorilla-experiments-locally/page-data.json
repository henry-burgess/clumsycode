{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/building-and-testing-online-gorilla-experiments-locally/",
    "result": {"data":{"site":{"siteMetadata":{"title":"Clumsy Code"}},"markdownRemark":{"id":"943006fb-6a9b-5199-884b-bf9815a727df","excerpt":"After spending time myself developing experiments that were to run locally in a laboratory and online via Gorilla, I decided to spend some time trying to work…","html":"<p>After spending time myself developing experiments that were to run locally in a laboratory and online via Gorilla, I decided to spend some time trying to work out a way that I could streamline my development such that I would only have to modify code in one location - on my laptop in the comfort of my own development environment and configuration.</p>\n<h2>Using JavaScript with Gorilla</h2>\n<p>Gorilla allows users to create a <em>jsPsych Starter</em> project that includes a template JavaScript (JS) file and resources that allow the user to integrate jsPsych projects into Gorilla. Gorilla has a nice online IDE that facilitates development.</p>\n<p>The main advantage of writing JS inside the Gorilla online IDE is having easy integration with the Gorilla API.</p>\n<p>The <code class=\"language-text\">main</code> file created by Gorilla in the experiment template is initialised with the following contents:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> gorilla <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gorilla/gorilla\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Make sure to upload the jsPsych files you need to the resources tab.</span>\n<span class=\"token comment\">// This should include the main jsPsych.js, jsPsych.css and likely at least one plugin. </span>\n<span class=\"token comment\">// In this case, we use the jspsych-html-keyboard-response.js plugin file.</span>\n<span class=\"token keyword\">var</span> jsPsych <span class=\"token operator\">=</span> window<span class=\"token punctuation\">[</span><span class=\"token string\">'jsPsych'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\ngorilla<span class=\"token punctuation\">.</span><span class=\"token function\">ready</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">var</span> timeline <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> \n\n  <span class=\"token keyword\">var</span> hello_trial <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    type<span class=\"token operator\">:</span> <span class=\"token string\">'html-keyboard-response'</span><span class=\"token punctuation\">,</span>\n    stimulus<span class=\"token operator\">:</span> <span class=\"token string\">'Hello world!'</span>\n  <span class=\"token punctuation\">}</span>\n\n  timeline<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>hello_trial<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  jsPsych<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    display_element<span class=\"token operator\">:</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#gorilla'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    timeline<span class=\"token operator\">:</span> timeline<span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">on_data_update</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n      gorilla<span class=\"token punctuation\">.</span><span class=\"token function\">metric</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">on_finish</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n      gorilla<span class=\"token punctuation\">.</span><span class=\"token function\">finish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>From here, there are two ways of working with JS in Gorilla:</p>\n<ol>\n<li><em>Method One:</em> Modify source code using the online IDE. This method is safe, and will work almost all of the time. There will be very few unexpected errors. I personally think the online IDE is quite nice, particularly for smaller experiments!</li>\n<li><em>Method Two:</em> Write JS locally, modifying and copying it inside the <code class=\"language-text\">gorilla.ready</code> function when it is ready to be tested in Gorilla. Based on my experience using this method, there are many traps that you can fall into, and many repetitive operations when copying code from the local development environment to Gorilla. If you want to split your code into multiple files, there is no safety when referencing <code class=\"language-text\">export</code>-ed objects and classes. This method can lead to carnage if not thoroughly tested.</li>\n</ol>\n<p>What if I want to add some other exciting third-party libraries like WebGazer? Use 3D stimuli built with WebGL or WebAssembly? React even? As it stands, there is no easy way to facilitate this kind of integration with Gorilla.</p>\n<p>The solution I propose will accomplish the following goals:</p>\n<ol>\n<li>One codebase that is operable in both the local development environment and on the Gorilla platform.</li>\n<li>Ability to bundle additional third-party libraries such as React, WebGazer, and WebAssembly executables.</li>\n<li>Develop experiments using TypeScript or JavaScript (TS / JS).</li>\n<li>Streamline development of online experiments using Gorilla by enabling use of modern web development tools such as WebPack.</li>\n</ol>\n<p>A solution to these challenges would allow developers to compile the code to test at least the functionality and appearance locally, and the only functionality unable to be tested locally would be the Gorilla API calls.</p>\n<p>The bedrock of this solution I am proposing is essentially a targeted build system. Conceptually, there are two build targets: <code class=\"language-text\">desktop</code> (local development environment), and <code class=\"language-text\">gorilla</code> (online on the Gorilla platform). Build target <code class=\"language-text\">desktop</code> is the target used when building and testing the task locally, and the <code class=\"language-text\">gorilla</code> build is only run before uploading or integrating the task with the Gorilla platform.</p>\n<h2>Local development</h2>\n<p>Before I start explaining my solution, I would be well-served explaining the primary challenge I encountered along the way. Hopefully if someone knows a better way to address this, they may be able to help me out!</p>\n<p>Based on the contents of the <code class=\"language-text\">main</code> file above, we can see straight away that there will be issues when trying to run and test this code locally.</p>\n<p>The primary issue, on line 1, is the <code class=\"language-text\">import gorilla = require(\"gorilla/gorilla\");</code> call. The <code class=\"language-text\">gorilla/gorilla</code> package is not publicly available via NPM, so this is the first thing that will not be possible locally. This is the linkage to the API used throughout the code.</p>\n<p>Later in the file, we see calls to <code class=\"language-text\">gorilla.ready</code>, <code class=\"language-text\">gorilla.metric</code>, and <code class=\"language-text\">gorilla.finish</code>, all essential functions when integrating the task to the Gorilla API.</p>\n<p>We can be confident when building and testing the game in a local development environment, it is not possible to test the specific API calls.</p>\n<p>If you’d like to check out the entire codebase for an experiment that uses this method, check out the GitHub repository here: <a href=\"https://github.com/henry-burgess/experiments\">https://github.com/henry-burgess/experiments</a> I’ve set it up as a GitHub ‘template’ so hopefully people can use it a bit easier.</p>\n<p><strong>Disclaimer:</strong> You won’t be able to run the code snippets without some setup or configuration. The code snippets below are intended to be pseudocode that hopefully explain my intentions and strategy to developing a solution. If you want to know more of the intricacies of the configuration, check out the repository, or skip down to the ‘How do I run it?’ section. Better yet, try it out for yourself and let me know how you go!</p>\n<h3>Digging into the code</h3>\n<p>Let’s get started with the easy part - deciding what code to run at execution time. This part of the system relies somewhat on JS being a ‘scripting’ language, opposed to a compiled language. I specified a <code class=\"language-text\">config.js</code> file which held, amongst other parameters, the build target string (<code class=\"language-text\">gorilla</code> or <code class=\"language-text\">desktop</code>). I created a new basic <code class=\"language-text\">if</code> block like the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Initialise jsPsych and Gorilla (if required)</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>target <span class=\"token operator\">===</span> <span class=\"token string\">'gorilla'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>target <span class=\"token operator\">===</span> <span class=\"token string\">'desktop'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// ...</span></code></pre></div>\n<p>Now we can easily specify what code we want to run on each target platform.</p>\n<h3><code class=\"language-text\">window</code> objects</h3>\n<p>An important (and somewhat hacky) concept that underlies this solution is the existence of objects in <code class=\"language-text\">window</code> space. These objects are somewhat similar to global variables, and can be accessed like any other JS object by calling <code class=\"language-text\">window['object-name']</code>. When an <code class=\"language-text\">import</code> statement is compiled and then eventually executed, some imported libraries may configure a new <code class=\"language-text\">window</code> object. Fortunately for us, that’s exactly what jsPsych and Gorilla do. At runtime, <code class=\"language-text\">window['jsPsych']</code> and <code class=\"language-text\">window['gorilla']</code> (only if the code is running on Gorilla though) objects exist.</p>\n<p>What’s the catch with this method? Well, we can only reliably access <code class=\"language-text\">window</code> objects after the window has loaded. So, I will wrap the <code class=\"language-text\">if</code> statement above in a function called when the window has finished loading. This function is the <code class=\"language-text\">window.onload</code> function. We end up with the following code:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ...</span>\nwindow<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> timeline <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n  <span class=\"token comment\">// Define your timeline here!</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>target <span class=\"token operator\">===</span> <span class=\"token string\">'gorilla'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Wait for the entire page to be loaded before accessing jsPsych and Gorilla</span>\n    <span class=\"token keyword\">const</span> _gorilla <span class=\"token operator\">=</span> window<span class=\"token punctuation\">[</span><span class=\"token string\">'gorilla'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> _jsPsych <span class=\"token operator\">=</span> window<span class=\"token punctuation\">[</span><span class=\"token string\">'jsPsych'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>target <span class=\"token operator\">===</span> <span class=\"token string\">'desktop'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Wait for the entire page to be loaded before accessing jsPsych and Gorilla</span>\n    <span class=\"token keyword\">const</span> _jsPsych <span class=\"token operator\">=</span> window<span class=\"token punctuation\">[</span><span class=\"token string\">'jsPsych'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// ...</span></code></pre></div>\n<p>You’ll see that I’ve also included variables inside the <code class=\"language-text\">if</code> blocks that store <code class=\"language-text\">window['jsPsych']</code> and <code class=\"language-text\">window['gorilla']</code> as required. We only need jsPsych for the desktop target, but we need both Gorilla and jsPsych for the Gorilla version.</p>\n<p>In any subsequent code inside the <code class=\"language-text\">if</code> blocks will be run depending on the platform specified in the configuration file.</p>\n<h3>Targeting <code class=\"language-text\">desktop</code></h3>\n<p>Let’s start with an easy win, setting up the <code class=\"language-text\">desktop</code> configuration. The first thing to do is to check that jsPsych has actually been loaded successfully. The easiest way to catch most possible errors is to wrap the <code class=\"language-text\">jsPsych.init</code> method in an <code class=\"language-text\">if</code> block like so:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>target <span class=\"token operator\">===</span> <span class=\"token string\">'desktop'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Wait for the entire page to be loaded before accessing jsPsych and Gorilla</span>\n  <span class=\"token keyword\">const</span> _jsPsych <span class=\"token operator\">=</span> window<span class=\"token punctuation\">[</span><span class=\"token string\">'jsPsych'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>_jsPsych<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// jsPsych.init block here...</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Fatal: jsPsych not loaded.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// ...</span></code></pre></div>\n<p>You’ll see I added an error message if for some reason the variable comes back <code class=\"language-text\">undefined</code>. Next I can <code class=\"language-text\">require(...)</code> any other jsPsych plugins that I plan to be using in my timeline. This should be done before <code class=\"language-text\">jsPsych.init</code> is called, otherwise any plugins used in your timeline will be <code class=\"language-text\">undefined</code> at the time of running <code class=\"language-text\">jsPsych.init</code> and will raise an error.</p>\n<p>For example, if I wish to use the <code class=\"language-text\">jspsych-instructions.js</code> plugin in my timeline, I would simply add <code class=\"language-text\">require('jspsych/plugins/jspsych-instructions');</code> inside my new <code class=\"language-text\">if</code> block like so:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>target <span class=\"token operator\">===</span> <span class=\"token string\">'desktop'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Wait for the entire page to be loaded before accessing jsPsych and Gorilla</span>\n  <span class=\"token keyword\">const</span> _jsPsych <span class=\"token operator\">=</span> window<span class=\"token punctuation\">[</span><span class=\"token string\">'jsPsych'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>_jsPsych<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 'require' any jsPsych plugins used, so that they are loaded at this stage of the script execution</span>\n    <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'jspsych/plugins/jspsych-instructions'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// jsPsych.init block here...</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Fatal: jsPsych not loaded.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// ...</span></code></pre></div>\n<p>Finally, I can then call the <code class=\"language-text\">jsPsych.init</code> method using my parameters of choice, but note how the <code class=\"language-text\">_jsPsych</code> variable is used below:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>target <span class=\"token operator\">===</span> <span class=\"token string\">'desktop'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Wait for the entire page to be loaded before accessing jsPsych and Gorilla</span>\n  <span class=\"token keyword\">const</span> _jsPsych <span class=\"token operator\">=</span> window<span class=\"token punctuation\">[</span><span class=\"token string\">'jsPsych'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>_jsPsych<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 'require' any jsPsych plugins used, so that they are loaded at this stage of the script execution</span>\n    <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'jspsych/plugins/jspsych-instructions'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    _jsPsych<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      timeline<span class=\"token operator\">:</span> timeline<span class=\"token punctuation\">,</span>\n      <span class=\"token function-variable function\">on_finish</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// ...</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Fatal: jsPsych not loaded.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// ...</span></code></pre></div>\n<p>That’s it for <code class=\"language-text\">desktop</code>! Hopefully you see there is a simple logical sequence like so:</p>\n<ul>\n<li>Get the jsPsych <code class=\"language-text\">window</code> object.</li>\n<li>If it is defined, continue.\n<ul>\n<li>If it is not defined, stop execution.</li>\n</ul>\n</li>\n<li>Load any plugins that were used in the experiment timeline.</li>\n<li>Call the <code class=\"language-text\">jsPsych.init</code> method.</li>\n</ul>\n<p>Let’s move onto the final boss, getting the <code class=\"language-text\">gorilla</code> target working!</p>\n<h3>Targeting <code class=\"language-text\">gorilla</code></h3>\n<p>I will start with the code snippet below that is inside the <code class=\"language-text\">window.onload</code> function:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>target <span class=\"token operator\">===</span> <span class=\"token string\">'gorilla'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Wait for the entire page to be loaded before accessing jsPsych and Gorilla</span>\n  <span class=\"token keyword\">const</span> _gorilla <span class=\"token operator\">=</span> window<span class=\"token punctuation\">[</span><span class=\"token string\">'gorilla'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> _jsPsych <span class=\"token operator\">=</span> window<span class=\"token punctuation\">[</span><span class=\"token string\">'jsPsych'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// ...</span></code></pre></div>\n<p>The next step is to confirm that Gorilla and jsPsych have been loaded correctly, raising an error if not:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>target <span class=\"token operator\">===</span> <span class=\"token string\">'gorilla'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Wait for the entire page to be loaded before accessing jsPsych and Gorilla</span>\n  <span class=\"token keyword\">const</span> _gorilla <span class=\"token operator\">=</span> window<span class=\"token punctuation\">[</span><span class=\"token string\">'gorilla'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> _jsPsych <span class=\"token operator\">=</span> window<span class=\"token punctuation\">[</span><span class=\"token string\">'jsPsych'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>_gorilla <span class=\"token operator\">&amp;&amp;</span> _jsPsych<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// gorilla.ready block here...</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Fatal: Gorilla or jsPsych not loaded.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// ...</span></code></pre></div>\n<p>Again, I <code class=\"language-text\">require(...)</code> any plugins I may be using in my timeline:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>target <span class=\"token operator\">===</span> <span class=\"token string\">'gorilla'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Wait for the entire page to be loaded before accessing jsPsych and Gorilla</span>\n  <span class=\"token keyword\">const</span> _gorilla <span class=\"token operator\">=</span> window<span class=\"token punctuation\">[</span><span class=\"token string\">'gorilla'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> _jsPsych <span class=\"token operator\">=</span> window<span class=\"token punctuation\">[</span><span class=\"token string\">'jsPsych'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>_gorilla <span class=\"token operator\">&amp;&amp;</span> _jsPsych<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Require any jsPsych plugins, so that they are loaded here</span>\n    <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'jspsych/plugins/jspsych-instructions'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Fatal: Gorilla or jsPsych not loaded.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// ...</span></code></pre></div>\n<p>Next, I can add a call to the <code class=\"language-text\">gorilla.ready</code> function, similar to the original online template file:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>target <span class=\"token operator\">===</span> <span class=\"token string\">'gorilla'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Wait for the entire page to be loaded before accessing jsPsych and Gorilla</span>\n  <span class=\"token keyword\">const</span> _gorilla <span class=\"token operator\">=</span> window<span class=\"token punctuation\">[</span><span class=\"token string\">'gorilla'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> _jsPsych <span class=\"token operator\">=</span> window<span class=\"token punctuation\">[</span><span class=\"token string\">'jsPsych'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>_gorilla <span class=\"token operator\">&amp;&amp;</span> _jsPsych<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Require any jsPsych plugins, so that they are loaded here</span>\n    <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'jspsych/plugins/jspsych-instructions'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    _gorilla<span class=\"token punctuation\">.</span><span class=\"token function\">ready</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// jsPsych.init block here...</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Fatal: Gorilla or jsPsych not loaded.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// ...</span></code></pre></div>\n<p>Finally, I can essentially paste in the <code class=\"language-text\">jsPsych.init</code> call from the original template file inside the <code class=\"language-text\">gorilla.ready</code> API call. I just need to replace any <code class=\"language-text\">jsPsych</code> references with <code class=\"language-text\">_jsPsych</code>, and any <code class=\"language-text\">gorilla</code> references with <code class=\"language-text\">_gorilla</code> like so:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>target <span class=\"token operator\">===</span> <span class=\"token string\">'gorilla'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Wait for the entire page to be loaded before accessing jsPsych and Gorilla</span>\n  <span class=\"token keyword\">const</span> _gorilla <span class=\"token operator\">=</span> window<span class=\"token punctuation\">[</span><span class=\"token string\">'gorilla'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> _jsPsych <span class=\"token operator\">=</span> window<span class=\"token punctuation\">[</span><span class=\"token string\">'jsPsych'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>_gorilla <span class=\"token operator\">&amp;&amp;</span> _jsPsych<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Require any jsPsych plugins, so that they are loaded here</span>\n    <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'jspsych/plugins/jspsych-instructions'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    _gorilla<span class=\"token punctuation\">.</span><span class=\"token function\">ready</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      _jsPsych<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        display_element<span class=\"token operator\">:</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#gorilla'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        timeline<span class=\"token operator\">:</span> timeline<span class=\"token punctuation\">,</span>\n        <span class=\"token function-variable function\">on_data_update</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n          _gorilla<span class=\"token punctuation\">.</span><span class=\"token function\">metric</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function-variable function\">on_finish</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n          _gorilla<span class=\"token punctuation\">.</span><span class=\"token function\">finish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Fatal: Gorilla or jsPsych not loaded.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// ...</span></code></pre></div>\n<p>And that’s it! That’s the essence of coding up the two alternate implementation depending on whether the target is <code class=\"language-text\">gorilla</code> or <code class=\"language-text\">desktop</code>.</p>\n<p>You should have something that generally resembles the snippet below:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ...</span>\nwindow<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> timeline <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n  <span class=\"token comment\">// Define your timeline here!</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>target <span class=\"token operator\">===</span> <span class=\"token string\">'gorilla'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Wait for the entire page to be loaded before initialising jsPsych and Gorilla</span>\n    <span class=\"token comment\">// Once all modules are loaded into the window, access Gorilla API and jsPsych library</span>\n    <span class=\"token keyword\">const</span> _gorilla <span class=\"token operator\">=</span> window<span class=\"token punctuation\">[</span><span class=\"token string\">'gorilla'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> _jsPsych <span class=\"token operator\">=</span> window<span class=\"token punctuation\">[</span><span class=\"token string\">'jsPsych'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Make sure Gorilla and jsPsych are loaded</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>_gorilla <span class=\"token operator\">&amp;&amp;</span> _jsPsych<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Require any jsPsych plugins, so that they are loaded here</span>\n      <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'jspsych/plugins/jspsych-instructions'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      _gorilla<span class=\"token punctuation\">.</span><span class=\"token function\">ready</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        _jsPsych<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          display_element<span class=\"token operator\">:</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#gorilla'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n          timeline<span class=\"token operator\">:</span> timeline<span class=\"token punctuation\">,</span>\n          <span class=\"token function-variable function\">on_data_update</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            _gorilla<span class=\"token punctuation\">.</span><span class=\"token function\">metric</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token function-variable function\">on_finish</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            _gorilla<span class=\"token punctuation\">.</span><span class=\"token function\">finish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Fatal: Gorilla or jsPsych not loaded.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>target <span class=\"token operator\">===</span> <span class=\"token string\">'desktop'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Once all modules are loaded into the window, access jsPsych library</span>\n    <span class=\"token keyword\">const</span> _jsPsych <span class=\"token operator\">=</span> window<span class=\"token punctuation\">[</span><span class=\"token string\">'jsPsych'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Make sure jsPsych is loaded</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>_jsPsych<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Require any jsPsych plugins, so that they are loaded here</span>\n      <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'jspsych/plugins/jspsych-instructions'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      _jsPsych<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        timeline<span class=\"token operator\">:</span> timeline<span class=\"token punctuation\">,</span>\n        <span class=\"token function-variable function\">on_finish</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Fatal: jsPsych not loaded.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>How am I using this?</h2>\n<p>The repository I’ve setup here is an example: <a href=\"https://github.com/henry-burgess/experiments\">https://github.com/henry-burgess/experiments</a>. It would take many words to try and explain how to configure the tools exactly how I have them setup now!</p>\n<h3>Desktop</h3>\n<p>To develop the experiment locally, I firstly check that the <code class=\"language-text\">target</code> in <code class=\"language-text\">src/config/config.js</code>  is set to <code class=\"language-text\">desktop</code>. Running <code class=\"language-text\">yarn dev</code> starts a local development server that will re-compile the code on any changes. I can then preview the experiment in the browser on my local machine. I am now ready to make any changes to the code I want to. If I want to add a new dependency (e.g., React, WebGazer, etc.), I simply install the dependency using <code class=\"language-text\">yarn</code> and can use it however I wish in the experiment.</p>\n<p>If I want to deploy the experiment for a laboratory context, I can go ahead and run <code class=\"language-text\">yarn build</code>. This will generate a HTML and <code class=\"language-text\">*.bundle.js</code> file in the <code class=\"language-text\">built/</code> subdirectory. These two files are all that is required to run the experiment offline on a laboratory computer.</p>\n<p><img src=\"Screen%20Shot%202021-08-04%20at%207.04.21%20pm.png\" alt=\"The experiment running in the local development environment.\"></p>\n<h3>Gorilla</h3>\n<p>As explained in the ‘Desktop’ section above, I can easily go about developing the experiment and previewing the experiment in my browser.</p>\n<p>If I want to generate a Gorilla build, I usually run <code class=\"language-text\">yarn clean</code> to remove any old build artefacts, set the <code class=\"language-text\">target</code> in <code class=\"language-text\">src/config/config.js</code>  to <code class=\"language-text\">gorilla</code>, and run <code class=\"language-text\">yarn build</code>. This will generate a HTML and <code class=\"language-text\">*.bundle.js</code> file in the <code class=\"language-text\">built/</code> subdirectory. I then upload the <code class=\"language-text\">*.bundle.js</code> file as a ‘Resource’ in my Gorilla experiment. If this is the first time testing the experiment on Gorilla, I need to set the ‘Head’ contents in Gorilla to the following (replacing <code class=\"language-text\">*.bundle.js</code> with the actual name of your resource):</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{{resource <span class=\"token punctuation\">'</span>*.bundle.js<span class=\"token punctuation\">'</span>}}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>I can then click ‘Preview’ and see the experiment running online in Gorilla!</p>\n<p><img src=\"Screen%20Shot%202021-08-04%20at%207.10.46%20pm.png\" alt=\"The experiment running online in Gorilla.\"></p>\n<p>To update the Gorilla version, I simply run a new build locally, and then re-upload the <code class=\"language-text\">*.bundle.js</code> file as a ‘Resource’.</p>\n<h2>Tooling</h2>\n<p>Here’s a bit more detail below about the tools and how I specifically used them.</p>\n<h3>TypeScript</h3>\n<p>I used TypeScript for this project, requiring me to configure a TS compiler. The configuration I have currently allows JS, TS, and JSX / TSX to all reside together and be bundled. TS also provides a bit more confidence in typing, catching a few potential bugs when compiling it to JS.</p>\n<h3>WebPack</h3>\n<p>WebPack acted as the pipeline that would compile the TS code and bundle any dependencies. In order to get jsPsych bundled, I did have to add a couple of lines at the top of the file to ensure it was added:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Import jsPsych to ensure it is bundled when compiled</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'jspsych/jspsych'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Additionally, you may have noticed a <code class=\"language-text\">$</code> symbol in the <code class=\"language-text\">gorilla</code> target code. This was a reference to the jQuery library that Gorilla uses. I added jQuery as a dependency and imported it into the file also:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Import jQuery to build for Gorilla</span>\n<span class=\"token keyword\">import</span> $ <span class=\"token keyword\">from</span> <span class=\"token string\">'jquery'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>I also made use of the WebPack development server, which would reload the in-browser preview each time I made a change. I needed to then incorporate the <code class=\"language-text\">HtmlWebpackPlugin</code> that would generate a HTML file alongside the bundled code enabling the preview to be rendered in the browser. You can see the exact configuration in the <code class=\"language-text\">webpack.config.js</code> file in the root of the repository.</p>\n<h3>React</h3>\n<p>I was able to easily incorporate React into the example project linked above. I created a <code class=\"language-text\">screens.tsx</code> file which I plan to fill out with a few examples showcasing the capabilities of this project. Currently, I have tested a number of React UI libraries, including <em>React Bootstrap</em> (<a href=\"https://react-bootstrap.github.io/\" title=\"React Bootstrap\">https://react-bootstrap.github.io/</a>), <em>Chakra UI</em> (<a href=\"https://chakra-ui.com/\">https://chakra-ui.com/</a>), and currently <em>Grommet</em> (<a href=\"https://v2.grommet.io/\">https://v2.grommet.io/</a>). I did encounter issues with <em>Chakra UI</em> in Gorilla, but that is why the Gorilla builds should be tested frequently when playing around with third-party libraries. <em>React Bootstrap</em> and <em>Grommet</em> both work fine.</p>\n<h2>Conclusion</h2>\n<p>Let’s revisit the goals of this little project:</p>\n<ol>\n<li>One codebase that is operable in the local development environment and on the Gorilla platform.</li>\n<li>Ability to bundle additional third-party libraries such as React, WebGazer, and even WebAssembly executables.</li>\n<li>Develop experiments using TypeScript or JavaScript (TS / JS).</li>\n<li>Streamline development of online experiments using Gorilla by enabling use of modern web development tools such as WebPack.</li>\n</ol>\n<p>Firstly, we’ve allowed a distinction to be made between the <code class=\"language-text\">desktop</code> and <code class=\"language-text\">gorilla</code> build targets. The code initialising jsPsych is subtly different between the two targets, however it allows jsPsych to be configured correctly for each target.</p>\n<p>Secondly, since we are using modern development tools such as TypeScript, WebPack, and <code class=\"language-text\">yarn</code>, we are able to add dependencies and import them as required. This includes React and WebGazer which are both integrated with the repository. Additionally, I have had success creating a basic 3D game in Unity, exporting it to the HTML5 / WebGL target, and loading the WASM module both in the desktop and Gorilla builds.</p>\n<p>Thirdly, this has already been covered above, but TS and JS are supported in the codebase. Additionally, TSX and JSX formats can be used given that React is well-supported.</p>\n<p>Finally, the entire process has been simplified and streamlined, making use of modern development tools. The use of these tools has made it possible to create experiments that run both locally and on Gorilla. These tools have opened online experimentation to an enormous collection of open-source libraries that will hopefully lead to exciting and adventurous online experiments being created in the future.</p>\n<p>I would appreciate any feedback that more experienced web developers may have on this project! I am somewhat new to web development, so any testing would be much-appreciated also.</p>","frontmatter":{"title":"Building and testing online Gorilla experiments locally","date":"August 05, 2021","description":"A potential solution for JavaScript developers looking to create experiments for Gorilla on their machines locally."}},"previous":null,"next":null},"pageContext":{"id":"943006fb-6a9b-5199-884b-bf9815a727df","previousPostId":null,"nextPostId":null}},
    "staticQueryHashes": ["2355076697","3347749741"]}